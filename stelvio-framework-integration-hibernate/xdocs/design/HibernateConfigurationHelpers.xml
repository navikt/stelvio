<?xml version="1.0" encoding="iso-8859-1"?>
<document>
	<properties>
		<title>Detaljert Design</title>
	</properties>
	<body>
	<section name="Hjelpeklasser for bruk av Hibernate konfigurasjonen">
		<subsection name="Oversikt">
		 	<p>For å forenkle bruken av Hibernate konfigurasjonen og for å kunne bygge meldingstjenester
			med støtte for rekursivitet, er det bygget noen hjelpe klasser for dette.
			</p>
			<table>
				<tr>
					<td><b>Navn</b></td>
					<td>RecordConverter</td>
				</tr>
				<tr>
					<td><b>Type</b></td>
					<td>static helper</td>
				</tr>
				<tr>
					<td><b>Beskrivelse</b></td>
					<td>Konverterer fra en JavaBean til en melding og visa versa.</td>
				</tr>
			</table>
			<h4>Klassediagram</h4>
			<img src="../images/design/HibernateHelperClassDiagram.png"/>
			<h4>Sekvensdiagram</h4>
			<img src="../images/design/HibernateHelperSeqDiagram.png"/>
		</subsection>
		<subsection name = "Bruk">
			<a name="bruk"/>
			<p>Bruken av helpeklassene gjøres gjennom bruken av Hibernate konfigurasjonen, med tillegg av <b>offset</b>.
			Under følger et eksempel på konfigurasjon av en CICS record i Hibernate mapping konfigurasjonen.</p>
			<source>
<![CDATA[
<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN" "http://hpapt03/dtd/hibernate-mapping-2.0.dtd">
<hibernate-mapping>
	<class name="no.stelvio.integration.framework.Foreldre" table="FORELDRE" schema="K460M700">
		<id name="id" column="id" type="long">
			<generator class="hilo"></generator>
		</id>
		<property name="aksjonskode" 		column="M700-AKSJONSKODE" 		type="string" 	length="8" 	offset="0"/>
		<property name="sakNr" 			column="M700-SAKSNR" 			type="string" 	length="7" 	offset="8"/>
		<property name="soknadsType" 		column="M700-KODE-SOKNADSTYPE" 		type="string" 	length="2" 	offset="15"/>
		<property name="ugKode" 		column="M700-UG-KODE" 			type="string" 	length="2" 	offset="17"/>
		<property name="datoSoknad" 		column="M700-DATO-SOKNAD" 		type="string" 	length="8" 	offset="19"/>
		<property name="datoSokFOM" 		column="M700-DATO-SOKT-FOM" 		type="string" 	length="8" 	offset="27"/>
		<property name="datoBerTOM" 		column="M700-DATO-BEREGN-TOM" 		type="string" 	length="8" 	offset="35"/>
		<property name="brukerId" 		column="M700-BRUKERID" 			type="string" 	length="8" 	offset="43"/>
		<property name="objectnrBP" 		column="M700-OBJEKTNR-BP" 		type="string" 	length="2" 	offset="51"/>
		<property name="personIdBP" 		column="M700-PERSON-ID-BP" 		type="string" 	length="11" 	offset="53"/>
		<property name="soktGebyrFriBP" 	column="M700-SOKT-GEBYRFRITAK-BP" 	type="string" 	length="1" 	offset="64"/>
		<property name="objectnrBM" 		column="M700-OBJEKTNR-BM" 		type="string" 	length="2" 	offset="65"/>
		<property name="personIdBM" 		column="M700-PERSON-ID-BM" 		type="string" 	length="11" 	offset="67"/>
		<property name="soktGebyrFriBM" 	column="M700-SOKT-GEBYRFRITAK-BM"	type="string" 	length="1" 	offset="78"/>
		<property name="feilPeker" 		column="M700-FEIL-FELTPEKER-1"		type="string" 	length="3" 	offset="79"/>
		<property name="numRecords"		column="M700-ANT-BARN-ELEMENTER" 	type="int" 	length="2" 	offset="82"/>
		<set name="barn">
			<key column="M700-ANT-BARN-ELEMENTER"/>
			<one-to-many class="no.stelvio.integration.framework.Barn" offset="84" length="540"/>
		</set>	
	</class>
	<class name="no.stelvio.integration.framework.Barn" table="BARN" schema="K460M700">
		<id name="id" column="id" type="long">
			<generator class="hilo"></generator>
		</id>
		<property name="objectNr" 	column="M700-OBJEKTNR-BARN" 		type="string" length="2" 	offset="0"/>
		<property name="personId" 	column="M700-PERSON-ID-BARN" 		type="string" length="11" 	offset="2"/>
		<property name="bidragFl" 	column="M700-BIDRAG-FLAGG" 		type="string" length="1" 	offset="13"/>
		<property name="tillBidragFl" 	column="M700-TILL-BIDRAG-FLAGG" 	type="string" length="1" 	offset="14"/>
		<property name="forskuddFl" 	column="M700-FORSKUDD-FLAGG" 		type="string" length="1" 	offset="15"/>
		<property name="saerTilskFl" 	column="M700-SAERTILSK-FLAGG" 		type="string" length="1" 	offset="16"/>
		<property name="samvaerKls" 	column="M700-SAMVAER-KLASSE" 		type="string" length="2" 	offset="17"/>
		<property name="innkrevFl" 	column="M700-INNKREV-FLAGG" 		type="string" length="1" 	offset="19"/>
		<property name="belopLopBidrag" column="M700-BELOP-LOPENDE-BIDRAG" 	type="string" length="9" 	offset="20"/>
		<property name="feilPeker" 	column="M700-FEIL-FELTPEKER-2" 		type="string" length="6" 	offset="29"/>
	</class>
</hibernate-mapping>
]]>
		</source>
		<p>Det er noe som er viktig å merke seg med konfigurasjoen over.</p>
		<ol>
			<li>id tagen er påkrevd i Hibernate, og er derfor med her også, men ikke i bruk.</li>
			<li>Den eneste relasjonen som er lovlig er en-til-mange</li>
		</ol>
		<p>Videre for å få benytte RecordConverter må man hente ut konfigurasjonen fra konfigurasjonsfilen.
		Denne må ligge i classpath for å kunne gjøres tilgjengelig ved følgende kodesnutt:</p>
		<source>
<![CDATA[
String conf = "bidragsberegning_" + NAME + ".hbm.xml";
ClassLoader resourceLoader =
	Thread.currentThread().getContextClassLoader();
InputStream stream = resourceLoader.getResourceAsStream(conf);
Configuration config = new Configuration();
try {
	config.addInputStream(stream);
} catch (MappingException e) {
	// TODO Auto-generated catch block
	e.printStackTrace();
}

RootClass clazz =
	RecordHelper.getServiceRootClass(configuration, "TABLENAME");

StringBuffer buffer = new StringBuffer();

// Create a string from the given service
RecordConverter.classToRecord(configuration, clazz, obj, buffer);
]]>
		</source>
		</subsection>
			<subsection name = "Endringslogg">
<source><![CDATA[
$Log$
Revision 1.3  2004/06/18 10:29:22  tkc2920
Rettet opp skrivefeil etter kommentarer fra Hårvard Bjåstad

Revision 1.2  2004/06/17 07:59:39  tkc2920
Lagt in ny endringslogg for automatisk logg ved insjekking i CVS
]]>			
</source>
			</subsection>
	</section>
	</body>
</document>

