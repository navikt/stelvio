<?xml version="1.0" encoding="iso-8859-1"?>
<document>
	<properties>
		<title>Feilhåndtering - Design</title>
	</properties>
	<body>
		<section name="Feilhåndtering - Design">
			
			<subsection name="Oversikt">
			
				<p>
					Feilhåndtering er en viktig tjeneste som både arkitektur og applikasjoner har
					behov for. Pakken <i>no.stelvio.common.error</i>
					består av klasser og interface for feilhåndtering. 
				</p>
				<p>
					Følgende funksjonalitet skal ivareta driftssikker og driftsvennlig håndtering av 
					ulike typer feil og avvik:
				</p>
				<ul>
					<li> 
						Alle feil og avvik tilordnes en unik feil-id for å identifisere alle spesifikke feil 
						som har oppstått samt skille de fra hverandre. Følgefeil vil inneholde en referanse 
						til den originale feilen. <br/>
					</li>
					<li> 
						Alle feil og avvik knyttes mot en bruker-id for å identifisere hvilken bruker som har 
						utført operasjonen hvor feilen har oppstått. Alternativt benyttes en system-id når 
						funksjonaliteten ikke er brukerinitiert, som for eksempel batcher. <br/>
					</li>
					<li>
						Alle feil og avvik knyttes mot hvilket vindu brukeren jobbet i og hvilken handling brukeren
						utførte når feilen oppstod.
					</li>
					<li> 
						Alle feil og avvik knyttes mot en unik transaksjons-id for å identifisere 
						i hvilken transaksjon operasjonen som feilet inngikk i. <br/>
					</li>
					<li> 
						Logging av feil og avvik delegeres til tjenesten for hendelseslogging. <br/>
					</li>
					<li> 
						En feil eller et avvik logges aldri mer enn én gang. <br/>
					</li>
					<li> 
						Feil og avvik som propageres fra et tjenestelag til et tilstøtende tjenestelag 
						inneholder aldri nøstede feil eller avvik. Dette gjøres for å unngå problemer med 
						classloading. <br/>
					</li>
					<li> 
						Forventede feiltyper identifiseres, navngis og kategoriseres i henhold til type og 
						alvorlighetsgrad. Denne informasjonen vedlikeholdes i en databasetabell.<br/>
					</li>
				</ul>
				
			</subsection>			
			
			<subsection name="Beskrivelse">
			
				<h4>LoggableException</h4>
				<p>
					<i>LoggableException</i> er et interface alle klasser som representerer en systemfeil eller 
					applikasjonsfeil må implementer for at feilene skal kunne logges korrekt.
				</p>
				
				<h4>ApplicationException</h4>
				<p>
					<i>ApplicationException</i> er klasse som representerer en feil i applikasjonslogikken. 
					En applikasjonskomponent oppretter og sender en feil av denne typen tilbake til komponenten 
					som initierte kodekallet, for å signalisere at et avvik i funksjonaliteten har oppstått. 
				</p>
				<p>
					Dersom den kallende kompoenten klarer å håndtere avviket, skal avviket fanges opp og håndteres 
					med en gang. Dersom avviket ikke kan håndteres av komponenten skal det sendes videre, eventuelt 
					pakket inn i en ny og mer generell <i>ApplicationException</i>.
				</p>
				<p>
					Applikasjonene skal <b>IKKE</b> logge avviket, da dette ivaretas av arkitekturen.
				</p>
				
				<h4>SystemException</h4>
				<p>
					<i>SystemException</i> er en klasse som representerer en feil i systemet som applikasjonene 
					ikke skal kunne forvente og heller ikke håndtere.
				</p>
				<p>
					Applikasjonene skal <b>IKKE</b> håndtere eller logge avviket, da dette ivaretas av arkitekturen.
					Dersom en systemfeil oppstår i applikasjonslogikken skal den ikke fanges opp, men sendes videre
					uten næremere håndtering.
				</p>
				<p>
					Arkitekturkomponenter kan håndtere systemfeil, men skal <b>IKKE</b> logge feilen. Dersom 
					arkitekturkomponenten ønsker å håndtere feilen skal dette foregå ved at feilen pakkes inn i 
					en ny og mer generell <i>SystemException</i>.
				</p>
				
				<h4>ErrorCode</h4>
				<p>
					<i>ErrorCode</i> er en konstant som benyttes for å identifisere feiltypen. En konstant består 
					av et heltall (int), som benyttes for å slå opp hvor alvorlig feilen er i tillegg til å opprette 
					selve feilmeldingen som presenteres for brukeren. 
				</p>
				<p>
					Konstantene i <i>ErrorCode</i> er typesikre for å tvinge at alle feilkoder samles og defineres 
					i subklasser, slik at det blir enklere å holde en oversikt over alle feiltypene. <br/>
					Se <a href="../apidocs/no/stelvio/common/framework/error/ErrorCode.html">
                    no.stelvio.common.error.old.ErrorCode
                </a> for detaljer.
				</p>
				
				<h4>Severity</h4>
				<p>
					<i>Severity</i> inneholder konstanter som representerer de ulike alvorlighetsgradene 
					en feil kan ha. Konstantene benyttes kun internt i feilhåndteringstjenestene.
				</p>
				
				<h4>ErrorHandler</h4>
				<p>
					<i>ErrorHandler</i> er den sentrale komponenten i feilhåndteringstjenestene. Klassen er 
					implementert som en <i>Singleton (GoF)</i> og benytter en intern <i>Handler</i> til å 
					håndtere selve feilen.
				</p>
				
				<h4>Handler</h4>
				<p>
					<i>Handler</i> er et interface som definerer hvordan feil skal håndteres.
				</p>
				
				<h4>DefaultHandlerImpl</h4>
				<p>
					<i>DefaultHandlerImpl</i> er en klasse som implementerer feilhåndtering ved å logge til
					systemloggen. Alle feil håndteres på samme måte og logges direkte uten å slå opp feilmeldingen
					og alvorlighetsgraden. Dersom log-tjenestene ikke er tilgjengelige, skrives feilene direkte 
					til <i>System.out</i>.
				</p>
				
				<h4>LogHandlerImpl</h4>
				<p>
					<i>LogHandlerImpl</i> er en klasse som implementerer feilhåndtering ved å logge til systemloggen 
					og/eller den sentrale driftsloggen. Klassen implementerer funksjonalitet for å slå opp 
					feilmelding og alvorlighetsgrad basert på feilkode, samt logikk for å håndtere hva som skal logges,
					og hvor det skal logges.
				</p>			
				<h4>InitErrorHandler</h4>
				<p>
					<i>InitErrorHandler</i> er en forretningstjeneste som benyttes av <i>LogHandlerImpl</i> for å 
					initialisere koblingen mellom feilkode, alvorlighetsgrad og feilmelding for samtlige feil. 
					Denne informasjonen leses fra applikasjonens database.
				</p>
			
			</subsection>
			
			<subsection name="Klassediagram">
			
				<p><img src="../images/design/ErrorHandlingClass.gif" /></p>
				
			
			</subsection>
			<subsection name = "Endringslogg">
<source><![CDATA[
$Log$
Revision 1.3  2004/06/16 13:53:01  psa2920
la til endringslogg
]]>			
</source>
			</subsection>
			
		</section>
	</body>
</document>

