<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>no.nav.build</groupId>
	<artifactId>ear-configurer</artifactId>
	<packaging>pom</packaging>
	<version>1.0-SNAPSHOT</version>
	<name>Kontroller prosjekt for konfigurering</name>
	<profiles>
		<profile>
			<id>usage</id>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
						<executions>
							<execution>
								<phase>process-sources</phase>
								<configuration>
									<tasks>	  							
										<echo>------------------------------------------- USAGE --------------------------------------------------------------------</echo>
										<echo>----------------------------------------------------------------------------------------------------------------------</echo>
										<echo>-                                                                                                                    -</echo>
										<echo>- 1. fixear (trigger=fixear)                         										                           -</echo>
										<echo>-				mappingfile=		path to ear file including filename                                                -</echo>
										<echo>-									defaults to M:\DevArch_Tools_Shared\DevArch\tools\moose\build_version_mapping.txt  -</echo>
										<echo>-				mooseid=			moose build id to fix                                                              -</echo>
										<echo>-				envfile=			path to environment file containing properties for module                          -</echo>
										<echo>-				workingarea=		path to temporary working area (defaults to D:\Deploy_Temp)                        -</echo>
										<echo>-                                                                                                                    -</echo>
										<echo>- 2. ltpa security fix (trigger=ltpa)                        									                       -</echo>
										<echo>-				workingarea=		path to temporary working area (defaults to D:\Deploy_Temp)                        -</echo>
										<echo>-                                                                                                                    -</echo>
										<echo>- 3. wasdeploy (trigger=wasdeploy)                         								                           -</echo>
										<echo>-				host=				machine to deploy to (default localhost)					                       -</echo>
										<echo>-				port=				SOAP port (default 8880)									                       -</echo>
										<echo>-				username=			websphere username											                       -</echo>
										<echo>-				password=			websphere password											                       -</echo>
										<echo>-				mooseid=			moose build id to fix                                                              -</echo>
										<echo>-				cluster=			cluster name if deploying to cluster environment			                       -</echo>
										<echo>-				module=				module being deployed (pen, psak, pselv, popp, medl, preg)	                       -</echo>
										<echo>-				module.version=		version of module to deploy                                                        -</echo>
										<echo>----------------------------------------------------------------------------------------------------------------------</echo>
									</tasks>
								</configuration>
								<goals>
									<goal>run</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<id>fixear</id>
			<build>
				<plugins>
					<plugin>
						<groupId>no.nav.maven.plugins</groupId>
						<artifactId>maven-fix-ear-plugin</artifactId>
						<executions>
							<execution>
								<phase>process-sources</phase>
								<id>fixear</id>
								<configuration>
									<mappingFile>M:\DevArch_Tools_Shared\DevArch\tools\moose\build_version_mapping.txt</mappingFile>
									<workingArea>D:\Deploy_Temp</workingArea>
								</configuration>
								<goals>
									<goal>fixear</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
			<activation>
				<property>
					<name>fixear</name>
				</property>
			</activation>
		</profile>
		<profile>
			<id>ltpa</id>
			<build>
				<plugins>
					<plugin>
						<groupId>no.nav.maven.plugins</groupId>
						<artifactId>maven-ltpa-plugin</artifactId>
						<executions>
							<execution>
								<phase>process-sources</phase>
								<id>ltpa</id>
								<goals>
									<goal>setupLTPA</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
			<activation>
				<property>
					<name>ltpa</name>
				</property>
			</activation>
		</profile>
		<profile>
			<id>wasdeploy</id>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
						<executions>
							<execution>
								<phase>validate</phase>
								<id>build</id>
								<configuration>
									<tasks>	  							
										<property name="compile.classpath" refid="maven.compile.classpath" />
										<taskdef resource="net/sf/antcontrib/antlib.xml">
											<classpath>
												<pathelement path="${compile.classpath}" />
											</classpath>
										</taskdef>
										<condition property="host" value="localhost">
											<not>
												<isset property="host" />
											</not>
										</condition>
										<condition property="port" value="8880">
											<not>
												<isset property="port" />
											</not>
										</condition>
										<condition property="username" value="EMPTY">
											<not>
												<isset property="username" />
											</not>
										</condition>
										<condition property="password" value="EMPTY">
											<not>
												<isset property="password" />
											</not>
										</condition>
										<condition property="layers" value="all">
											<not>
												<isset property="layers" />
											</not>
										</condition>
										<condition property="mappingFile" value="M:\DevArch_Tools_Shared\DevArch\tools\moose\build_version_mapping.txt">
											<not>
												<isset property="mappingFile" />
											</not>
										</condition>
										<condition property="workingArea" value="D:\Deploy_Temp">
											<not>
												<isset property="workingArea" />
											</not>
										</condition>
										<if>
											<not><isset property="mooseid"/></not>
											<then>
												<fail message="mooseid not specified!" />
											</then>
										</if>
									
										<exec dir="."
										executable="${wid.home}/runtimes/bi_v6/bin/ws_ant.bat"
										failonerror="false"
										errorproperty="error"
										>
											<arg
											line="  
										-Dhost=${host}
										-Dport=${port}
										-Dusername=${username}
										-Dpassword=${password}
										-Dwas.home=${wid.home}/runtimes/bi_v6 
										-Dwid.lib=${wid.home}/runtimes/bi_v6/lib 
										-Dmaven.compile.classpath='${compile.classpath}' 
										-DmooseId=${mooseid}
										-DmappingFile=${mappingFile}
										-DworkingArea=${workingArea}
										-Dcluster=${cluster}
										-buildfile was-deploy.xml" />																 
										</exec>

										<if>
											<not><equals arg1="${error}" arg2="" /></not>
											<then>
												<fail message="Feil under deploy: [${error}]"/>																
											</then>
										</if>
									</tasks>
								</configuration>
								<goals>
									<goal>run</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
			<activation>
				<property>
					<name>wasdeploy</name>
				</property>
			</activation>
		</profile>
	</profiles>

	<dependencies>
		<!--<dependency>
			<groupId>net.sf.antcontrib</groupId>
			<artifactId>ant-contrib</artifactId>
			<version>1.0b3</version>
		</dependency>-->
		<dependency>
			<groupId>net.sf.antcontrib</groupId>
			<artifactId>ant-contrib</artifactId>
			<version>1.0b3</version>
		</dependency>
	</dependencies>
</project>
