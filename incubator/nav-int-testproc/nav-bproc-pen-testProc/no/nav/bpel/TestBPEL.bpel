<?xml version="1.0" encoding="UTF-8"?>
<bpws:process xmlns:bpws="http://schemas.xmlsoap.org/ws/2004/03/business-process/" xmlns:ns="http://nav-bproc-pen-testProc/no/nav/bpel/TestBPELArtifacts" xmlns:ns0="http://nav-bproc-pen-testProc/no/nav/gbo" xmlns:ns1="http://nav-bproc-pen-testProc/no/nav/inf/TestProc" xmlns:ns2="http://nav-lib-pen/no/nav/lib/pen/gbo" xmlns:ns3="http://nav-lib-pen/no/nav/lib/pen/inf/Vedtak" xmlns:ns4="http://nav-lib-test/no/nav/lib/test/gbo" xmlns:ns5="http://nav-lib-pen/no/nav/lib/pen/inf/Pensjonssak" xmlns:tel="http://nav-bproc-pen-testProc/no/nav/bpel/Task1" xmlns:wpc="http://www.ibm.com/xmlns/prod/websphere/business-process/6.0.0/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.ibm.com/xmlns/prod/websphere/business-process/expression-lang/java/6.0.0/" name="TestBPEL" suppressJoinFailure="yes" targetNamespace="http://nav-bproc-pen-testProc/no/nav/bpel" wpc:autoDelete="no" wpc:autonomy="peer" wpc:displayName="TestBPEL" wpc:id="4" wpc:validFrom="2008-10-03T08:10:13">
  <wpc:customProperty name="terminatedSuccessful">
    <wpc:value>false</wpc:value>
  </wpc:customProperty>
  <wpc:javaGlobals>
    <wpc:import packages="java.util.Date"/>
    <wpc:import packages="java.util.GregorianCalendar"/>
    <wpc:import packages="no.stelvio.common.bus.util.DateUtil"/>
    <wpc:import packages="no.stelvio.common.bus.util.StringUtils"/>
    <wpc:import packages="java.util.List"/>
  </wpc:javaGlobals>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="../lib/test/inf/TestProc.wsdl" namespace="http://nav-bproc-pen-testProc/no/nav/inf/TestProc"/>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="../lib/pen/inf/Vedtak.wsdl" namespace="http://nav-lib-pen/no/nav/lib/pen/inf/Vedtak"/>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="TestBPELArtifacts.wsdl" namespace="http://nav-bproc-pen-testProc/no/nav/bpel/TestBPELArtifacts"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../../../xsd-includes/http.nav-lib-test.no.nav.lib.test.gbo.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="../lib/pen/inf/Vedtak.wsdl" namespace="http://nav-lib-pen/no/nav/lib/pen/inf/Vedtak"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../../../xsd-includes/http.nav-lib-pen.no.nav.lib.pen.gbo.xsd" namespace="http://nav-lib-pen/no/nav/lib/pen/gbo"/>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="../lib/test/inf/TestProc.wsdl" namespace="http://nav-bproc-pen-testProc/no/nav/inf/TestProc"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOHentVedtakRequest.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOHentVedtakListeRequest.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOTestProcRequest.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOVedtakListe.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOVedtak.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="../lib/test/inf/Vedtak.wsdl" namespace="http://nav-lib-pen/no/nav/lib/pen/inf/Vedtak"/>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="/resource/nav-lib-test/no/nav/lib/test/inf/Pensjonssak.wsdl" namespace="http://nav-lib-pen/no/nav/lib/pen/inf/Pensjonssak"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOHentPensjonssakRequest.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOPensjonssak.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:import importType="http://schemas.xmlsoap.org/wsdl/" location="../lib/test/inf/Pensjonssak.wsdl" namespace="http://nav-lib-pen/no/nav/lib/pen/inf/Pensjonssak"/>
  <bpws:import importType="http://www.w3.org/2001/XMLSchema" location="../lib/test/gbo/GBOKontrollpunkt.xsd" namespace="http://nav-lib-test/no/nav/lib/test/gbo"/>
  <bpws:partnerLinks>
    <bpws:partnerLink myRole="Interface" name="TestProc" partnerLinkType="ns:TestProcPLT"/>
    <bpws:partnerLink name="VedtakPartner" partnerLinkType="ns:VedtakPLT" partnerRole="Interface"/>
    <bpws:partnerLink name="PensjonssakPartner" partnerLinkType="ns:PensjonssakPLT" partnerRole="Interface"/>
  </bpws:partnerLinks>
  <bpws:variables>
    <bpws:variable name="testProcRequest" type="ns4:GBOTestProcRequest" wpc:id="3"/>
    <bpws:variable name="hentVedtakListeRequest" type="ns4:GBOHentVedtakListeRequest" wpc:id="7"/>
    <bpws:variable name="hentVedtakRequest" type="ns4:GBOHentVedtakRequest" wpc:id="10"/>
    <bpws:variable name="hentVedtakResponse" type="ns4:GBOVedtak" wpc:id="11"/>
    <bpws:variable name="hentVedtakListeResponse" type="ns4:GBOVedtakListe" wpc:id="16"/>
    <bpws:variable name="vedtakId" type="xsd:string" wpc:id="18"/>
    <bpws:variable name="virkningBefore" type="xsd:boolean" wpc:id="28"/>
    <bpws:variable name="hentPensjonssakRequest" type="ns4:GBOHentPensjonssakRequest" wpc:id="39"/>
    <bpws:variable name="hentPensjonssakResponse" type="ns4:GBOPensjonssak" wpc:id="40"/>
    <bpws:variable name="lagreVedtakRequest" type="ns4:GBOVedtak" wpc:id="42"/>
    <bpws:variable name="lagreVedtakResponse" type="xsd:string" wpc:id="41"/>
    <bpws:variable name="opprettKontrollpunktRequest" type="ns4:GBOKontrollpunkt" wpc:id="47"/>
    <bpws:variable name="opprettKontrollpunktResponse" type="ns4:GBOKontrollpunkt" wpc:id="48"/>
  </bpws:variables>
  <bpws:correlationSets>
    <bpws:correlationSet name="VedtakIdCorrelation" properties="ns:vedtakId"/>
  </bpws:correlationSets>
  <bpws:sequence name="HiddenSequence" wpc:id="1073741825">
    <bpws:receive createInstance="yes" name="Receive" operation="invokeTestProc" partnerLink="TestProc" portType="ns1:TestProc" wpc:displayName="Receive" wpc:id="2">
      <wpc:output>
        <wpc:parameter name="testProcRequest" variable="testProcRequest"/>
      </wpc:output>
      <bpws:correlations>
        <bpws:correlation initiate="yes" set="VedtakIdCorrelation"/>
      </bpws:correlations>
    </bpws:receive>
    <bpws:scope name="Scope" wpc:displayName="Scope" wpc:id="5">
      <bpws:faultHandlers>
        <bpws:catchAll>
          <bpws:invoke name="HandterFeil" operation="null" partnerLink="null" portType="wpc:null" wpc:continueOnError="no" wpc:displayName="HandterFeil" wpc:id="46">
            <wpc:script>
              <wpc:javaCode><![CDATA[System.out.println("Fanget en feil");]]></wpc:javaCode>
            </wpc:script>
          </bpws:invoke>
        </bpws:catchAll>
      </bpws:faultHandlers>
      <bpws:sequence name="HiddenSequence1" wpc:id="1073741832">
        <bpws:assign name="AssignhentVedtakRequest" wpc:displayName="Assign hentVedtakRequest" wpc:id="9">
          <bpws:copy>
            <bpws:from variable="testProcRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[vedtakId]]></bpws:query>
            </bpws:from>
            <bpws:to variable="hentVedtakRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[vedtakId]]></bpws:query>
            </bpws:to>
          </bpws:copy>
          <bpws:copy>
            <bpws:from variable="testProcRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[setDatoBefore]]></bpws:query>
            </bpws:from>
            <bpws:to variable="hentVedtakRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[setDatoBefore]]></bpws:query>
            </bpws:to>
          </bpws:copy>
          <bpws:copy>
            <bpws:from variable="testProcRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[triggerSbeHV]]></bpws:query>
            </bpws:from>
            <bpws:to variable="hentVedtakRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[triggerSbe]]></bpws:query>
            </bpws:to>
          </bpws:copy>
          <bpws:copy>
            <bpws:from variable="testProcRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[triggerSreHV]]></bpws:query>
            </bpws:from>
            <bpws:to variable="hentVedtakRequest">
              <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[triggerSre]]></bpws:query>
            </bpws:to>
          </bpws:copy>
        </bpws:assign>
        <bpws:invoke name="InvokehentVedtak" operation="hentVedtak" partnerLink="VedtakPartner" portType="ns3:Vedtak" wpc:continueOnError="no" wpc:displayName="Invoke hentVedtak" wpc:id="6">
          <wpc:input>
            <wpc:parameter name="hentVedtakRequest" variable="hentVedtakRequest"/>
          </wpc:input>
          <wpc:output>
            <wpc:parameter name="hentVedtakResponse" variable="hentVedtakResponse"/>
          </wpc:output>
        </bpws:invoke>
        <bpws:switch name="VirkningFom" wpc:displayName="VirkningFom" wpc:id="19">
          <bpws:case wpc:id="20">
            <bpws:condition expressionLanguage="http://www.ibm.com/xmlns/prod/websphere/business-process/expression-lang/java/6.0.0/"><![CDATA[String virkningFomStr=hentVedtakResponse.getString("virkningFom");
if (!StringUtils.isEmpty(virkningFomStr))
{
	Date virkningFom = DateUtil.parseWIDString(virkningFomStr);
	Date dato = new GregorianCalendar(2008,10,10).getTime();	
	if (virkningFom.before(dato))
		return true;
	else
		return false;
}else
	return false;]]></bpws:condition>
            <bpws:invoke name="ProsesserDatoFor" operation="null" partnerLink="null" portType="wpc:null" wpc:continueOnError="no" wpc:displayName="ProsesserDatoFor" wpc:id="31">
              <wpc:script>
                <wpc:javaCode><![CDATA[System.out.println("Dato før 10.10.2008");]]></wpc:javaCode>
              </wpc:script>
            </bpws:invoke>
          </bpws:case>
          <bpws:otherwise>
            <bpws:sequence name="HiddenSequence4" wpc:id="1073741854">
              <bpws:assign name="AssignhentVedtakListeRequest" wpc:displayName="Assign hentVedtakListeRequest" wpc:id="14">
                <bpws:copy>
                  <bpws:from variable="hentVedtakResponse">
                    <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[gjelderFnr]]></bpws:query>
                  </bpws:from>
                  <bpws:to variable="hentVedtakListeRequest">
                    <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[fnr]]></bpws:query>
                  </bpws:to>
                </bpws:copy>
              </bpws:assign>
              <bpws:invoke name="InvokehentVedtakListe" operation="hentVedtakListe" partnerLink="VedtakPartner" portType="ns3:Vedtak" wpc:continueOnError="no" wpc:displayName="Invoke hentVedtakListe" wpc:id="15">
                <wpc:input>
                  <wpc:parameter name="hentVedtakListeRequest" variable="hentVedtakListeRequest"/>
                </wpc:input>
                <wpc:output>
                  <wpc:parameter name="hentVedtakListeResponse" variable="hentVedtakListeResponse"/>
                </wpc:output>
              </bpws:invoke>
              <bpws:switch name="VedtakReturnert" wpc:displayName="VedtakReturnert" wpc:id="34">
                <bpws:case wpc:id="35">
                  <bpws:condition expressionLanguage="http://www.ibm.com/xmlns/prod/websphere/business-process/expression-lang/java/6.0.0/"><![CDATA[List vedtakListe = hentVedtakListeResponse.getList("vedtakListe");
if(vedtakListe==null)
	return false;

if(vedtakListe.isEmpty())
	return false;
else
	return true;
]]></bpws:condition>
                  <bpws:sequence name="HiddenSequence2" wpc:id="1073741860">
                    <bpws:assign name="AssignLagreVedtakRequest" wpc:displayName="AssignLagreVedtakRequest" wpc:id="37">
                      <bpws:copy>
                        <bpws:from variable="hentVedtakListeResponse">
                          <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[vedtakListe[1]/vedtakId]]></bpws:query>
                        </bpws:from>
                        <bpws:to variable="lagreVedtakRequest">
                          <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[vedtakId]]></bpws:query>
                        </bpws:to>
                      </bpws:copy>
                      <bpws:copy>
                        <bpws:from variable="hentVedtakListeResponse">
                          <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[vedtakListe[1]/gjelderFnr]]></bpws:query>
                        </bpws:from>
                        <bpws:to variable="lagreVedtakRequest">
                          <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[gjelderFnr]]></bpws:query>
                        </bpws:to>
                      </bpws:copy>
                    </bpws:assign>
                    <bpws:invoke name="InvokeLagreVedtak" operation="lagreVedtak" partnerLink="VedtakPartner" portType="ns3:Vedtak" wpc:continueOnError="no" wpc:displayName="InvokeLagreVedtak" wpc:id="38">
                      <wpc:input>
                        <wpc:parameter name="lagreVedtakRequest" variable="lagreVedtakRequest"/>
                      </wpc:input>
                      <wpc:output>
                        <wpc:parameter name="lagreVedtakResponse" variable="lagreVedtakResponse"/>
                      </wpc:output>
                    </bpws:invoke>
                  </bpws:sequence>
                </bpws:case>
                <bpws:otherwise>
                  <bpws:sequence name="HiddenSequence3" wpc:id="1073741867">
                    <bpws:assign name="AssignOpprettKontrollPunkt" wpc:displayName="AssignOpprettKontrollPunkt" wpc:id="44">
                      <bpws:copy>
                        <bpws:from><![CDATA[BAKSYS_UTILGJENGELIG]]></bpws:from>
                        <bpws:to variable="opprettKontrollpunktRequest">
                          <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[kontrollpunktTypeKode]]></bpws:query>
                        </bpws:to>
                      </bpws:copy>
                      <bpws:copy>
                        <bpws:from>true</bpws:from>
                        <bpws:to variable="opprettKontrollpunktRequest">
                          <bpws:query queryLanguage="http://www.w3.org/TR/1999/REC-xpath-19991116"><![CDATA[kritisk]]></bpws:query>
                        </bpws:to>
                      </bpws:copy>
                    </bpws:assign>
                    <bpws:invoke name="InvokeOpprettKontrollPunkt" operation="opprettKontrollpunkt" partnerLink="PensjonssakPartner" portType="ns5:Pensjonssak" wpc:continueOnError="no" wpc:displayName="InvokeOpprettKontrollPunkt" wpc:id="45">
                      <wpc:input>
                        <wpc:parameter name="opprettKontrollpunktRequest" variable="opprettKontrollpunktRequest"/>
                      </wpc:input>
                      <wpc:output>
                        <wpc:parameter name="opprettKontrollpunktResponse" variable="opprettKontrollpunktResponse"/>
                      </wpc:output>
                    </bpws:invoke>
                  </bpws:sequence>
                </bpws:otherwise>
              </bpws:switch>
            </bpws:sequence>
          </bpws:otherwise>
        </bpws:switch>
      </bpws:sequence>
    </bpws:scope>
  </bpws:sequence>
</bpws:process>
