<?xml version="1.0" encoding="iso-8859-1"?>
<document>
	<properties>
		<title>Feilhåndtering - Guide</title>
	</properties>
	<body>
		<section name="Feilhåndtering - Guide">
		
			<subsection name="Oversikt">
				<p>
					Det må håndteres feil som kan oppstå både internt i presentasjonslaget og feil som kommer fra underliggende
					lag. Kontrollerte feil i presentasjonslaget er valideringer som feiler. Det lages da en feil som kan
					presenteres i JSP siden med en JSP tag. Ukontrollerte feil internt i presentasjonslaget skal vises i en
					standard JSP side.
					<br/>
					Fra underliggende lag kan det komme to typer av Exceptions, ApplicationException og SystemException.
					SystemException skal ikke håndteres av presentasjonslaget (i en Action) men en ApplicationException må
					håndteres av den Action som kaller det underliggende laget. 
				</p>
			</subsection>
			
			<subsection name="Beskrivelse">
				<h4>Exceptions fra underliggende lag</h4>
					<p>
						SystemException er en alvorlig feil som indikerer at noe alvorlig er galt. En SystemException
						skal ikke fanges i Actionklassen men en side med en forstålig feilmelding skal vises til bruker.
						Se konfigurering for oppsett av system feil i presentasjonslaget
						<br/>
						En ApplicationException har ikke samme alvorlighetsgrad. Det kan f.eks. være at en business regel
						er brutt. Feilen fanges av ExceptionHandleren og Struts bruker oppsettet i konfigurasjonsfilen til
						å finne neste side/action. ExceptionHandleren bruker arkitekturen for å slå opp feilen og finne
						passende melding som skal vises for brukeren.
						Meldingen skal vises for brukeren som da får mulighet å rette opp feilen og prøve på nytt.
						<br/>
						OBS! For at en ApplicationException, som kommer fra underliggende lag, skal kunne vise en melding hentet
						fra arkitekturen må en egen handler brukes i exception taggen. Se eksemplet under konfigurasjon.
					</p>

				<h4>Ukontrollerte exceptions i presentasjonslaget</h4>
					<p>
						Feil som av en eller annen grunn ikke fanges skal håndteres av servleten. I web.xml finnes muligheter
						for å deklarere feilsider som skal vises hvis en feil ikke er håndtert.
						<br/>
						Eksempel:
						<br/>
<source><![CDATA[
<error-page>
	<exception-type>UnhandledException</exception-type>
	<location>/WEB-INF/jsp/exceptions/UnhandledException.jsp</location>
</error-page>
<error-page>
	<error-code>404</error-code>
	<location>/WEB-INF/jsp/exceptions/404PageNotFound.jsp</location>
</error-page>
<error-page>
	<error-code>500</error-code>
	<location>/WEB-INF/jsp/exceptions/500InternalServerError.jsp</location>
</error-page>

]]></source>
					</p>

				<h4>Kontrollerte exceptions i presentasjonslaget</h4>
					<p>
						Validering av inputdata er en typisk kontrollert feilsituasjon. Hvis valideringen finner ut at 
						verdiene som er sendt ikke er gyldige opprettes en melding som kan vises frem for brukeren.
						<a href="Validering.html">Her finnes mer informasjon om validering.</a>
					</p>
					
				<h4>Konfigurasjon</h4>
					<p>
						Exceptions konfigureres i struts-config.xml filen. Feil kan defineres som globale eller lokale til
						en action. De globale brukes for at fange alvorlige feilmeldinger som ikke fanges lokalt i noen action.
						<br/>
						Eksempel på en global og en lokal feilmelding i konfigurasjonsfilen:
<source><![CDATA[
<global-exceptions>
	<exception key="exception.systemexception"
    	   	type="no.nav.common.framework.error.SystemException"
		path="/WEB-INF/pages/SystemException.jsp">
	</exception>
</global-exceptions>

<action-mappings>

	<action path="/action2" 
		type="no.trygdeetaten.web.bidragproto.action.Action2" 
		name="secondForm" 
		scope="request" 
		input="/WEB-INF/jsp/pages/Page2.jsp">
		<exception key="non.existing.key" 
			scope="request" 
			handler="no.nav.web.framework.action.FrameworkExceptionHandler" 
			type="no.nav.common.framework.error.ApplicationException" 
			path="/WEB-INF/pages/Page2.jsp"/>
		<forward name="failure" path="/WEB-INF/pages/Page2.jsp" contextRelative="true" />
		<forward name="windowload" path="/WEB-INF/pages/Page2.jsp" contextRelative="true" />
		<forward name="success" path="/WEB-INF/pages/Page2.jsp" contextRelative="true" />
		<forward name="Action1" path="/action1.do" redirect="true" /> 
		<forward name="Action3" path="/action3.do" contextRelative="true" redirect="true" />
	</action>		

</action-mappings>
]]></source>
					</p>

				<h4>Driftsmeldinger</h4>
					<p>
						Viktige meldinger rørende systemet skal kunne meddeles til brukeren. Det er alvorlige meldinger
						som f.eks. nær forestående nedetid, alvorlig svekket responstid etc.
						<br/>
						Det er lagt inn funksjonalitet i arkitekturen til lagring og visning av driftsmeldinger. Det 
						må i tillegg lages en administrator JSPside der meldinger kan legges inn og slettes.
					</p>
			</subsection>
			
			<subsection name = "Endringslogg">
<source><![CDATA[
$Log$
Revision 1.2  2004/06/18 13:10:20  jla2920
Oppdatert etter review og satt inn ny endringslogg
]]>			
</source>
			</subsection>
		</section>
	</body>
</document>

